<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<title>Wait or Walk?</title>
		<link rel="stylesheet" href="{{url_for('static', filename='themes/Bootstrap.css')}}">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile.structure-1.2.0.min.css" />
		<link rel="stylesheet" href="{{url_for('static', filename='themes/jqm-icon-pack-2.1.2-fa.css')}}">
		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
		<script>
			var start_g;
			var end_g;
			$(function() {
			$('<a name="top"/>').insertBefore($('body').children().eq(0));
				 window.location.hash = 'top';
			 });
	$(document).ready(function(){
		$(".end").hide();
		$(".wait").hide();
		$(".walk").hide();
		$(".thinking").hide();
		$(".rainy").hide();
		$(".cold").hide();
		$(".again").hide();
		$(".rainytext").hide();
		$(".coldtext").hide();
		$(".start").click(function() {
			start_g = this.id;
			$(".start").hide();
			$(".end").show();
			$(function() {
				   $('body').scrollTop(0);
			   });
		}); 
		$(".end").click(function(){
			 end_g = this.id;
			 $(".end").hide();
			 $(".thinking").show();
			//Figure out if they should walk or wait.
			
			//Do a GET request to /shouldwait?start=startingLocation&end=endingLocation
			//it will return a 1 if you should wait and a 0 if you should walk
			$.get("/shouldwait", {"start" : start_g, "end" : end_g}, 
				function(result){
					//console.log(result);
					//Check weather, but only if the buses are operating (M-F, 7am-10pm)
					shouldwait = result.slice(0,1); 
					waittime = result.slice(2,4);
					var weather = 0;
					var currentdate = new Date();
					if((currentdate.getDay() != 0) && (currentdate.getDay() != 6)){
						//it's a weekday
						if((currentdate.getHours() > 7) && (currentdate.getHours() < 22)){
							//it's between 7am and 10pm
							var request = new XMLHttpRequest(); //jQuery? We don't need no stinkin' jQuery!
							request.open("GET", "/weather", false);
							request.send(null);
							weather = request.responseText;
							//console.log(weather);
						}
					}
					if(shouldwait == 0){
						//walk
						$(".walk").show();
						$(".again").show();
						if(weather == 1){
							//it's rainy
							$(".rainy").show();
							var phrase;
							if(waittime == 1){
								phrase = waittime.toString() + " minute, you can ride the bus and stay dry."
							} else {
								phrase = waittime.toString() + " minutes, you can ride the bus and stay dry."
							}
							$(".rainytext").append(phrase);
							$(".rainytext").show();
						}
						if(weather == 2){
							//it's cold
							$(".cold").show();
							var phrase;
							if(waittime == 1){
								phrase = waittime.toString() + " minute, you can ride the bus and stay warm."
							} else {
								phrase = waittime.toString() + " minutes, you can ride the bus and stay warm."
							}
							$(".coldtext").append(phrase);
							$(".coldtext").show();
						}
						$(".thinking").hide();
					} else if(shouldwait == 1){
						//wait
						$(".wait").show();
						$(".again").show();
						$(".thinking").hide();
					} else {
						console.log("Error: Got unexpected result from server");
					}	
				});
		});			

	});				
	</script>
	</head>
	<body>
		<div data-role="page" data-theme="a">
			<div data-role="header" data-position="inline">
			<center><h1>Should I wait or walk?</h1></center>
			</div>
			<div data-role="content" data-theme="a">

				<center><h2 class="start">Where are you?</h2><h2 class="end">Where are you going?</h2></h2></center>

				<center><h1 class="wait">You should wait.</h1><h1 class="walk">You should walk.</h1></center>
				<center><h3 class="wait">It'll be quicker to wait for the bus instead of walking.</h3>
					<h3 class="walk">It'll be quicker to walk instead of waiting for the bus.</h3><h3><div class="rainy"> It looks rainy though, so if you can hang around for <div class="rainytext"></div></div></h3><h3><div class="cold"> It's pretty cold though, so if you can hang around for <div class="coldtext"></div></div><br /> <a href="javascript:location.reload(true);" class="again" data-role="button" data-theme="b">Do it again</a></h3><h3 class="thinking">Hang on...</h3></center>
													

				<a href="#" class="start" id="fitten" data-role="button" data-theme="b">Fitten</a>
				<a href="#" class="start" id="mcm8th" data-role="button" data-theme="b">McMillian & 8th</a>
				<a href="#" class="start" id="8thhemp" data-role="button" data-theme="b">8th & Hemphill</a>
				<a href="#" class="start" id="fershemrt" data-role="button" data-theme="b">Ferst & Hemphill</a>
				<a href="#" class="start" id="fersstmrt" data-role="button" data-theme="b">Ferst & State</a>
				<a href="#" class="start" id="fersatmrt" data-role="button" data-theme="b">Ferst & Atlantic</a>
				<a href="#" class="start" id="ferschmrt" data-role="button" data-theme="b">Klaus</a>
				<a href="#" class="start" id="5thfowl" data-role="button" data-theme="b">Ferst & Fowler</a>
				<a href="#" class="start" id="tech5th" data-role="button" data-theme="b">Techwood & 5th</a>
				<a href="#" class="start" id="tech4th" data-role="button" data-theme="b">Techwood & 4th</a>
				<a href="#" class="start" id="techbob" data-role="button" data-theme="b">Techwood & Bobby Dodd</a>
				<a href="#" class="start" id="technorth" data-role="button" data-theme="b">Techwood & North Ave</a>
				<a href="#" class="start" id="nortavea_a" data-role="button" data-theme="b">North Ave Apartments</a>
				<a href="#" class="start" id="ferstcher" data-role="button" data-theme="b">Tech Tower</a>
				<a href="#" class="start" id="hubfers" data-role="button" data-theme="b">Hub/Ferst</a>
				<a href="#" class="start" id="centrstud" data-role="button" data-theme="b">Student Center</a>
				<a href="#" class="start" id="765femrt" data-role="button" data-theme="b">CRC</a>
		

				<a href="#" class="end" id="fitten" data-role="button" data-theme="c">Fitten</a>
				<a href="#" class="end" id="mcm8th" data-role="button" data-theme="c">McMillian & 8th</a>
				<a href="#" class="end" id="8thhemp" data-role="button" data-theme="c">8th & Hemphill</a>
				<a href="#" class="end" id="fershemrt" data-role="button" data-theme="c">Ferst & Hemphill</a>
				<a href="#" class="end" id="fersstmrt" data-role="button" data-theme="c">Ferst & State</a>
				<a href="#" class="end" id="fersatmrt" data-role="button" data-theme="c">Ferst & Atlantic</a>
				<a href="#" class="end" id="ferschmrt" data-role="button" data-theme="c">Klaus</a>
				<a href="#" class="end" id="5thfowl" data-role="button" data-theme="c">Ferst & Fowler</a>
				<a href="#" class="end" id="tech5th" data-role="button" data-theme="c">Techwood & 5th</a>
				<a href="#" class="end" id="tech4th" data-role="button" data-theme="c">Techwood & 4th</a>
				<a href="#" class="end" id="techbob" data-role="button" data-theme="c">Techwood & Bobby Dodd</a>
				<a href="#" class="end" id="technorth" data-role="button" data-theme="c">Techwood & North Ave</a>
				<a href="#" class="end" id="nortavea_a" data-role="button" data-theme="c">North Ave Apartments</a>
				<a href="#" class="end" id="ferstcher" data-role="button" data-theme="c">Tech Tower</a>
				<a href="#" class="end" id="hubfers" data-role="button" data-theme="c">Hub/Ferst</a>
				<a href="#" class="end" id="centrstud" data-role="button" data-theme="c">Student Center</a>
				<a href="#" class="end" id="765femrt" data-role="button" data-theme="c">CRC</a>


				<center><br /><br />Cooked up by <a href="http://hscott.net">Hunter Scott</a>.</center>



			</div>
		</div>
	</body>
	
</html>
